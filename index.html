<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto GEM RASA</title>
    <link rel="icon" type="image/png" href="icon.png"> <!-- آیکون مرورگر -->
    <style>
        /* استایل کلی برای طراحی جذاب و کیفیت 4K */
        body {
            font-family: 'Segoe UI', sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #1e1e2f, #3b3b5e);
            color: #fff;
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .icon-wrapper {
            text-align: center;
            margin-bottom: 30px;
        }
        .icon {
            width: 120px;
            height: 120px;
            display: block;
            margin: 0 auto;
            filter: drop-shadow(0 0 15px rgba(255, 215, 0, 0.7));
            transition: transform 0.3s;
        }
        .icon:hover {
            transform: scale(1.1);
        }
        h1 {
            font-size: 2.5rem;
            text-align: center;
            color: #ffd700;
            text-shadow: 0 0 15px rgba(255, 215, 0, 0.7);
            margin: 10px 0;
        }
        h3 {
            font-size: 1.5rem;
            color: #00eaff;
            margin: 20px 0 10px;
        }
        select, input, button {
            width: 100%;
            max-width: 400px;
            padding: 15px;
            margin: 10px auto;
            border-radius: 10px;
            font-size: 1.1rem;
            display: block;
            box-sizing: border-box;
        }
        select, input {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #fff;
        }
        input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }
        button {
            background: linear-gradient(90deg, #00eaff, #007bff);
            border: none;
            color: #fff;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        button:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(0, 234, 255, 0.5);
        }
        .market-data, .history {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 30px;
        }
        .market-card, .history-card {
            background: rgba(255, 255, 255, 0.08);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            text-align: left;
            transition: transform 0.3s;
        }
        .market-card:hover, .history-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.2);
        }
        #result {
            margin-top: 20px;
            font-size: 1.2rem;
            color: #00ffcc;
            text-align: center;
        }
        .charts {
            margin-top: 30px;
        }
        canvas {
            max-width: 100%;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- آیکون برنامه -->
        <div class="icon-wrapper">
            <img src="icon.png" alt="Crypto GEM RASA Icon" class="icon">
        </div>

        <!-- انتخاب زبان -->
        <select id="language" onchange="changeLanguage()">
            <option value="fa">فارسی</option>
            <option value="en">English</option>
            <option value="ru">Русский</option>
        </select>

        <!-- عنوان و خوشامدگویی -->
        <h1 data-lang="title"></h1>
        <p data-lang="welcome"></p>

        <!-- بخش تبدیل ارز -->
        <h3 data-lang="convert"></h3>
        <select id="fromCurrency">
            <option value="TON">TON (Toncoin)</option>
            <option value="SOL">SOL (Solana)</option>
            <option value="ADA">ADA (Cardano)</option>
            <option value="BTC">BTC (Bitcoin)</option>
            <option value="ETH">ETH (Ethereum)</option>
            <option value="BNB">BNB (Binance Coin)</option>
            <option value="SHIB">SHIB (Shiba Inu)</option>
            <option value="PEPE">PEPE (Pepe Coin)</option>
        </select>
        <input type="number" id="amount" data-lang-placeholder="amount">
        <select id="toCurrency">
            <option value="TON">TON (Toncoin)</option>
            <option value="SOL">SOL (Solana)</option>
            <option value="ADA">ADA (Cardano)</option>
            <option value="BTC">BTC (Bitcoin)</option>
            <option value="ETH">ETH (Ethereum)</option>
            <option value="BNB">BNB (Binance Coin)</option>
            <option value="SHIB">SHIB (Shiba Inu)</option>
            <option value="PEPE">PEPE (Pepe Coin)</option>
        </select>
        <button onclick="convertCurrency()" data-lang="convert_btn"></button>
        <p id="result"></p>

        <!-- داده‌های بازار -->
        <h3 data-lang="market_data"></h3>
        <div class="market-data" id="marketData"></div>

        <!-- تاریخچه معاملات -->
        <h3 data-lang="history"></h3>
        <div class="history" id="historyData"></div>

        <!-- چارت قیمت -->
        <h3 data-lang="charts"></h3>
        <div class="charts">
            <canvas id="priceChart"></canvas>
        </div>
    </div>

    <!-- کتابخانه‌های مورد نیاز -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // داده‌های زبان
        const translations = {
            fa: {
                title: "صرافی Crypto GEM RASA",
                welcome: "به صرافی تلگرامی خود خوش آمدید!",
                convert: "تبدیل ارز",
                amount: "مقدار را وارد کنید",
                convert_btn: "تبدیل کن",
                market_data: "داده‌های بازار",
                history: "تاریخچه معاملات",
                charts: "نمودار قیمت"
            },
            en: {
                title: "Crypto GEM RASA Exchange",
                welcome: "Welcome to your Telegram exchange!",
                convert: "Convert Currency",
                amount: "Enter amount",
                convert_btn: "Convert",
                market_data: "Market Data",
                history: "Transaction History",
                charts: "Price Charts"
            },
            ru: {
                title: "Биржа Crypto GEM RASA",
                welcome: "Добро пожаловать в вашу биржу в Telegram!",
                convert: "Конвертация валюты",
                amount: "Введите сумму",
                convert_btn: "Конвертировать",
                market_data: "Данные рынка",
                history: "История транзакций",
                charts: "Графики цен"
            }
        };

        // کلید API CoinMarketCap
        const API_KEY = "aed348d1-da74-4781-8bd5-48668bc78c88"; // کلید شما (موقت و ناامن)

        // نرخ تبدیل (نمونه)
        const exchangeRates = {
            "TON": { "SOL": 0.05, "ADA": 10, "BTC": 0.00008, "ETH": 0.002, "BNB": 0.01, "SHIB": 250000, "PEPE": 500000 },
            "SOL": { "TON": 20, "ADA": 200, "BTC": 0.0016, "ETH": 0.04, "BNB": 0.2, "SHIB": 5000000, "PEPE": 10000000 },
            "ADA": { "TON": 0.1, "SOL": 0.005, "BTC": 0.000008, "ETH": 0.0002, "BNB": 0.001, "SHIB": 25000, "PEPE": 50000 },
            "BTC": { "TON": 12500, "SOL": 625, "ADA": 125000, "ETH": 25, "BNB": 125, "SHIB": 3125000000, "PEPE": 6250000000 },
            "ETH": { "TON": 500, "SOL": 25, "ADA": 5000, "BTC": 0.04, "BNB": 5, "SHIB": 125000000, "PEPE": 250000000 },
            "BNB": { "TON": 100, "SOL": 5, "ADA": 1000, "BTC": 0.008, "ETH": 0.2, "SHIB": 25000000, "PEPE": 50000000 },
            "SHIB": { "TON": 0.000004, "SOL": 0.0000002, "ADA": 0.00004, "BTC": 0.00000000032, "ETH": 0.000000008, "BNB": 0.00000004, "PEPE": 2 },
            "PEPE": { "TON": 0.000002, "SOL": 0.0000001, "ADA": 0.00002, "BTC": 0.00000000016, "ETH": 0.000000004, "BNB": 0.00000002, "SHIB": 0.5 }
        };

        // داده‌های بازار (با API پر می‌شود)
        const marketData = {
            TON: { price: 0, volume: 0 },
            SOL: { price: 0, volume: 0 },
            ADA: { price: 0, volume: 0 },
            BTC: { price: 0, volume: 0 },
            ETH: { price: 0, volume: 0 },
            BNB: { price: 0, volume: 0 },
            SHIB: { price: 0, volume: 0 },
            PEPE: { price: 0, volume: 0 }
        };

        // داده‌های نمونه برای چارت (7 روز گذشته)
        const chartData = {
            TON: [5.10, 5.15, 5.18, 5.22, 5.19, 5.21, 5.20],
            SOL: [100, 101, 99, 103, 102, 101.5, 102.50],
            ADA: [0.43, 0.44, 0.45, 0.46, 0.44, 0.45, 0.45],
            BTC: [64000, 64500, 65000, 64800, 65200, 65100, 65000],
            ETH: [2550, 2580, 2600, 2590, 2610, 2605, 2600],
            BNB: [510, 515, 520, 518, 522, 521, 520],
            SHIB: [0.000020, 0.000021, 0.0000205, 0.0000212, 0.000021, 0.0000208, 0.000021],
            PEPE: [0.0000095, 0.000010, 0.0000098, 0.0000102, 0.000010, 0.0000099, 0.000010]
        };

        let transactionHistory = []; // ذخیره تاریخچه معاملات

        // دریافت داده‌ها از CoinMarketCap
        async function fetchMarketData() {
            try {
                const response = await fetch("https://pro-api.coinmarketcap.com/v1/cryptocurrency/listings/latest", {
                    method: "GET",
                    headers: {
                        "X-CMC_PRO_API_KEY": API_KEY,
                        "Accept": "application/json"
                    }
                });
                const data = await response.json();

                const coinMapping = {
                    "TON": "TONCOIN",
                    "SOL": "SOL",
                    "ADA": "ADA",
                    "BTC": "BTC",
                    "ETH": "ETH",
                    "BNB": "BNB",
                    "SHIB": "SHIB",
                    "PEPE": "PEPE"
                };

                data.data.forEach(coin => {
                    const symbol = coin.symbol;
                    const mappedKey = Object.keys(coinMapping).find(key => coinMapping[key] === symbol);
                    if (mappedKey) {
                        marketData[mappedKey].price = coin.quote.USD.price;
                        marketData[mappedKey].volume = coin.quote.USD.volume_24h;
                    }
                });
                updateMarketData(document.getElementById("language").value);
            } catch (error) {
                console.error("Error fetching data:", error);
                document.getElementById("marketData").innerHTML = "خطا در دریافت داده‌ها / Data fetch error / Ошибка получения данных";
            }
        }

        // تغییر زبان
        function changeLanguage() {
            const lang = document.getElementById("language").value;
            document.querySelectorAll("[data-lang]").forEach(el => {
                const key = el.getAttribute("data-lang");
                if (el.tagName === "INPUT") {
                    el.placeholder = translations[lang][key];
                } else {
                    el.innerText = translations[lang][key];
                }
            });
            updateMarketData(lang);
            updateHistory(lang);
            updateChart();
            document.body.style.direction Brotherhoodlang === "fa" ? "rtl" : "ltr";
        }

        // به‌روزرسانی داده‌های بازار
        function updateMarketData(lang) {
            const marketContainer = document.getElementById("marketData");
            marketContainer.innerHTML = "";
            const formatData = (coin, price, volume) => {
                if (lang === "fa") return `${coin}: قیمت ${price.toFixed(6)} دلار، حجم ${volume.toLocaleString()} دلار`;
                if (lang === "en") return `${coin}: Price $${price.toFixed(6)}, Volume $${volume.toLocaleString()}`;
                if (lang === "ru") return `${coin}: Цена $${price.toFixed(6)}, Объем $${volume.toLocaleString()}`;
            };
            Object.keys(marketData).forEach(coin => {
                const card = document.createElement("div");
                card.className = "market-card";
                card.innerText = formatData(coin, marketData[coin].price, marketData[coin].volume);
                marketContainer.appendChild(card);
            });
        }

        // به‌روزرسانی تاریخچه معاملات
        function updateHistory(lang) {
            const historyContainer = document.getElementById("historyData");
            historyContainer.innerHTML = "";
            const formatHistory = (entry) => {
                if (lang === "fa") return `${entry.amount} ${entry.from} به ${entry.to} = ${entry.result.toFixed(6)}`;
                if (lang === "en") return `${entry.amount} ${entry.from} to ${entry.to} = ${entry.result.toFixed(6)}`;
                if (lang === "ru") return `${entry.amount} ${entry.from} в ${entry.to} = ${entry.result.toFixed(6)}`;
            };
            transactionHistory.forEach(entry => {
                const card = document.createElement("div");
                card.className = "history-card";
                card.innerText = formatHistory(entry);
                historyContainer.appendChild(card);
            });
        }

        // به‌روزرسانی چارت
        let chartInstance;
        function updateChart() {
            const ctx = document.getElementById("priceChart").getContext("2d");
            if (chartInstance) chartInstance.destroy();
            chartInstance = new Chart(ctx, {
                type: "line",
                data: {
                    labels: ["Day 1", "Day 2", "Day 3", "Day 4", "Day 5", "Day 6", "Day 7"],
                    datasets: Object.keys(chartData).map(coin => ({
                        label: coin,
                        data: chartData[coin],
                        borderColor: getRandomColor(),
                        fill: false
                    }))
                },
                options: {
                    responsive: true,
                    scales: {
                        y: { beginAtZero: false }
                    }
                }
            });
        }
        function getRandomColor() {
            const letters = "0123456789ABCDEF";
            let color = "#";
            for (let i = 0; i < 6; i++) {
                color += letters[Math.floor(Math.random() * 16)];
            }
            return color;
        }

        // تبدیل ارز
        function convertCurrency() {
            const fromCurrency = document.getElementById("fromCurrency").value;
            const toCurrency = document.getElementById("toCurrency").value;
            const amount = parseFloat(document.getElementById("amount").value);
            const resultElement = document.getElementById("result");
            const lang = document.getElementById("language").value;

            if (!amount || amount <= 0) {
                resultElement.innerText = lang === "fa" ? "لطفاً مقدار معتبری وارد کنید." :
                                         lang === "en" ? "Please enter a valid amount." :
                                         "Пожалуйста, введите действительную сумму.";
                return;
            }
            if (fromCurrency === toCurrency) {
                resultElement.innerText = lang === "fa" ? "ارز مبدا و مقصد نمی‌توانند یکسان باشند." :
                                         lang === "en" ? "Source and target currencies cannot be the same." :
                                         "Исходная и целевая валюты не могут совпадать.";
                return;
            }

            const rate = exchangeRates[fromCurrency][toCurrency];
            const convertedAmount = amount * rate;
            resultElement.innerText = `${amount} ${fromCurrency} = ${convertedAmount.toFixed(6)} ${toCurrency}`;
           
            transactionHistory.push({ from: fromCurrency, to: toCurrency, amount, result: convertedAmount });
            updateHistory(lang);
            Telegram.WebApp.sendData(JSON.stringify({ from: fromCurrency, to: toCurrency, amount, result: convertedAmount }));
        }

        // آماده‌سازی اولیه
        Telegram.WebApp.ready();
        Telegram.WebApp.MainButton.show().onClick(() => convertCurrency());
        fetchMarketData(); // دریافت داده‌های زنده از CoinMarketCap
        changeLanguage(); // تنظیم زبان اولیه
    </script>
</body>
</html>